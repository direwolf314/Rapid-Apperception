<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

	<head>
		<title>Rapid Apperception</title>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />

        <!-- sytax highlighting -->
        <link rel="stylesheet" type="text/css" href="main.css" />
        <link rel="stylesheet" type="text/css" href="prism.css" />
		<link href="jqueryFileTree.css" rel="stylesheet" type="text/css" media="screen" />
        
        <script src="prism.js" type="text/javascript"></script>
		<script src="jquery.js" type="text/javascript"></script>
		<script src="jquery.easing.js" type="text/javascript"></script>
		<script src="jqueryFileTree.js" type="text/javascript"></script>

		<!-- Script for file browser-->
		<script type="text/javascript">
            var stored_tag_name;
            var current_file;

            function renderPreview(file){
                if (typeof current_file == 'undefined') {
                    return;
                }

                callback = function(data) {
                               $('#filePreview').html(data);
                               Prism.highlightAll();};
                    
                <!--alert("Stored tag name is:" + stored_tag_name); -->

                if (typeof stored_tag_name !== 'undefined' && stored_tag_name !== '') {
                    $.post("jqueryFilePreview.php", 
                        {file: file, tag_name: stored_tag_name}, 
                        callback);
                } else {
                    $.post("jqueryFilePreview.php", 
                        {file: file}, 
                         callback);
                }
            }
           
            // Print the contents of the file tree
            function renderFileTree() {
                $('#fileTreeDemo_1').fileTree( 
                    {root: 'testing/', script: 'connectors/jqueryFileTree2.php',
                    tag: stored_tag_name}, 
                    function(file) {
                        current_file = file;
                        renderPreview(file);
                    });
            }

            // Render the file tree when the page loads
			$(document).ready( function() {
                renderFileTree();
            });
                             
            // Script for clearing search bar when clicked
			$(function() {
				$("#tfq2b").click(function() {
					if ($("#tfq2b").val() == "Search tags"){
						$("#tfq2b").val(""); 
					}
				});
			});

		    // Script to click button on enter in textbox
			$(function() {
                $("#tfq2b").keyup(function(event) {
                    if(event.keyCode == 13) {
                        $("#tfq2bbutton").click();
                    }
                });
			});
        
            // Script to implement searching
			$(function() {
				$("#tfq2bbutton").click(function() {
                    <!--alert("Old stored tag name is:" + stored_tag_name);-->
                    if (stored_tag_name != $("#tfq2b").val()) {
                        stored_tag_name = $("#tfq2b").val();
                        renderFileTree();
                        renderPreview(current_file);
                    }
				});
			});
		</script>
	</head>
	
	<body>
		<div class="search">
            <input type="text" id="tfq2b" class="tftextinput2" 
                name="tag_name" size="42" maxlength="120" value="Search tags"/>
            <input type="button" id="tfq2bbutton" value=">" class="tfbutton2"/>
		</div>
		
		<div class="example">
			<table><tr>
				<td><div id="fileTreeDemo_1" class="browser"></div></td>
                <td><div id="filePreview" class="text"></div></td>
			</tr></table>
		</div>
	</body>
</html>
