<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

	<head>
		<title>Rapid Apperception</title>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />

        <!-- sytax highlighting -->
        <link rel="stylesheet" type="text/css" href="main.css" />
        
        <script src="prism.js" type="text/javascript"></script>
        <link rel="stylesheet" type="text/css" href="prism.css" />

		<script src="jquery-2.1.3.min.js" type="text/javascript"></script>
		<script src="jquery.easing.js" type="text/javascript"></script>

		<script src="jqueryFileTree.js" type="text/javascript"></script>
		<link href="jqueryFileTree.css" rel="stylesheet" type="text/css" media="screen" />

        <script src="jquery.ui.position.js" type="text/javascript"></script>
        <script src="jquery.contextMenu.js" type="text/javascript"></script>
        <link rel="stylesheet" type="text/css" href="jquery.contextMenu.css"/>

		<!-- Script for file browser-->
		<script type="text/javascript">
            var stored_tag_name;
            var current_file;

            function renderPreview(file){
                if (typeof current_file == 'undefined') {
                    return;
                }

                callback = function(data) {
                               $('#filePreview').html(data);
                               Prism.highlightAll();};
                    
                <!--alert("Stored tag name is:" + stored_tag_name); -->

                if (typeof stored_tag_name !== 'undefined' && stored_tag_name !== '') {
                    $.post("jqueryFilePreview.php", 
                        {file: file, tag_name: stored_tag_name}, 
                        callback);
                } else {
                    $.post("jqueryFilePreview.php", 
                        {file: file}, 
                         callback);
                }
            }

            // Retrieve the currently selected text
            function getSelectionText() {
                var text = "";
                if (window.getSelection) {
                    text = window.getSelection().toString();
                } else if (document.selection && document.selection.type != "Control") {
                    text = document.selection.createRange().text;
                }
                return text;
            }

            // Retrieve the extension of the current file
            function getExtension() {
                if (typeof current_file == 'undefined') {
                    return '';
                }
                return current_file.split('.').pop();
            }
           
            // Print the contents of the file tree
            function renderFileTree() {
                $('#fileTreeDemo_1').fileTree( 
                    {root: 'testing/', script: 'connectors/jqueryFileTree2.php',
                    tag: stored_tag_name}, 
                    function(file) {
                        current_file = file;
                        renderPreview(file);
                    });
            }

            // Render the file tree when the page loads
			$(document).ready( function() {
                renderFileTree();
            });
                             
            // Script for clearing search bar when clicked
			$(function() {
				$("#tfq2b").click(function() {
					if ($("#tfq2b").val() == "Search tags"){
						$("#tfq2b").val(""); 
					}
				});
			});

		    // Script to click button on enter in textbox
			$(function() {
                $("#tfq2b").keyup(function(event) {
                    if(event.keyCode == 13) {
                        $("#tfq2bbutton").click();
                    }
                });
			});
        
            // Script to implement searching
			$(function() {
				$("#tfq2bbutton").click(function() {
                    <!--alert("Old stored tag name is:" + stored_tag_name);-->
                    if (stored_tag_name != $("#tfq2b").val()) {
                        stored_tag_name = $("#tfq2b").val();
                        renderFileTree();
                        renderPreview(current_file);
                    }
				});
			});

            $(function(){
                $.contextMenu({
                    selector: '.context-menu-one', 
                    callback: function(key, options) {
                        <!--var m = "clicked: " + key;-->
                        <!--window.console && console.log(m) || alert(m); -->
                        alert('highlighted:' + getSelectionText());
                    },
                    items: {
                        "Add-Tag": {
                            "name": "Add Tag", 
                            "items": {
                                keyword_box: {
                                    name: "Keyword", 
                                    type: 'text', 
                                    value: getSelectionText()
                                },
                                tag_box: {
                                    name: "Tag", 
                                    type: 'text', 
                                    value: "io"
                                },
                                extension_box: {
                                    name: "Extension", 
                                    type: 'text', 
                                    value: getExtension()
                                },
                                submit_button: {
                                    name: "Something Clickable", 
                                    callback: $.noop
                                }
                            }
                        }
                    }
                });
                
                $('.context-menu-one').on('click', function(e){
                    console.log('clicked', this);
                })
            });



		</script>
	</head>
	
	<body>
		<div class="search">
            <input type="text" id="tfq2b" class="tftextinput2" 
                name="tag_name" size="42" maxlength="120" value="Search tags"/>
            <input type="button" id="tfq2bbutton" value=">" class="tfbutton2"/>
		</div>
		
		<div class="example">
            <table><tr>
                <td><div id="fileTreeDemo_1" class="browser"></div></td>
                <td><div id="filePreview" class="text context-menu-one"></div></td>
            </tr></table>
		</div>
	</body>
</html>
